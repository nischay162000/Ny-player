name: NY BOTS App Builder

on:
  workflow_dispatch:
    inputs:
      app_url:
        description: 'App Content URL'
        required: true
        default: 'https://nybots.ai'
        type: string
      app_name:
        description: 'App Name'
        required: true
        default: 'NY BOTS'
        type: string
      package_name:
        description: 'Package Name'
        required: true
        default: 'com.nybots.app'
        type: string

jobs:
  build-android-app:
    runs-on: ubuntu-latest
    
    steps:
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Setup Android SDK
      uses: android-actions/setup-android@v3
      
    - name: Create Android Project Structure
      run: |
        # Create project directories
        mkdir -p android-app/app/src/main/{java/com/nybots/app,res/{layout,values,mipmap-hdpi,mipmap-mdpi,mipmap-xhdpi,mipmap-xxhdpi,mipmap-xxxhdpi,raw,drawable,anim,xml}}
        mkdir -p android-app/gradle/wrapper
        cd android-app
        
        # Initialize Gradle wrapper using system Gradle
        gradle wrapper --gradle-version 8.0
        chmod +x gradlew
        
        # Create root build.gradle
        cat > build.gradle << 'EOF'
        buildscript {
            ext.kotlin_version = "1.9.10"
            dependencies {
                classpath 'com.android.tools.build:gradle:8.1.2'
                classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
            }
        }
        allprojects {
            repositories {
                google()
                mavenCentral()
            }
        }
        EOF
        
        # Create settings.gradle
        cat > settings.gradle << 'EOF'
        include ':app'
        rootProject.name = "NYBotsApp"
        EOF
        
        # Create app build.gradle
        cat > app/build.gradle << 'EOF'
        plugins {
            id 'com.android.application'
            id 'org.jetbrains.kotlin.android'
        }
        
        android {
            namespace '${{ github.event.inputs.package_name }}'
            compileSdk 34
            
            defaultConfig {
                applicationId "${{ github.event.inputs.package_name }}"
                minSdk 24
                targetSdk 34
                versionCode 1
                versionName "1.0.0"
            }
            
            buildTypes {
                release {
                    minifyEnabled false
                    proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
                }
            }
            
            compileOptions {
                sourceCompatibility JavaVersion.VERSION_1_8
                targetCompatibility JavaVersion.VERSION_1_8
            }
            
            kotlinOptions {
                jvmTarget = '1.8'
            }
            
            buildFeatures {
                viewBinding true
            }
        }
        
        dependencies {
            implementation 'androidx.core:core-ktx:1.12.0'
            implementation 'androidx.appcompat:appcompat:1.6.1'
            implementation 'com.google.android.material:material:1.10.0'
            implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
            implementation 'androidx.swiperefreshlayout:swiperefreshlayout:1.1.0'
            implementation 'androidx.webkit:webkit:1.8.0'
            implementation 'com.airbnb.android:lottie:6.1.0'
            implementation 'androidx.biometric:biometric:1.1.0'
        }
        EOF
        
        # Create gradle.properties
        cat > gradle.properties << 'EOF'
        android.useAndroidX=true
        android.enableJetifier=true
        org.gradle.jvmargs=-Xmx4096m -XX:MaxMetaspaceSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8
        org.gradle.parallel=true
        org.gradle.configureondemand=true
        org.gradle.daemon=true
        org.gradle.caching=true
        android.enableR8.fullMode=true
        EOF
        
    - name: Create Activities and Kotlin Files
      run: |
        cd android-app
        
        # Create MainActivity.kt
        cat > app/src/main/java/com/nybots/app/MainActivity.kt << 'EOF'
        package com.nybots.app
        
        import android.Manifest
        import android.content.Intent
        import android.graphics.Bitmap
        import android.net.Uri
        import android.os.Bundle
        import android.os.Handler
        import android.os.Looper
        import android.view.KeyEvent
        import android.view.View
        import android.view.WindowManager
        import android.webkit.*
        import android.widget.ProgressBar
        import androidx.activity.result.contract.ActivityResultContracts
        import androidx.appcompat.app.AppCompatActivity
        import androidx.biometric.BiometricManager
        import androidx.biometric.BiometricPrompt
        import androidx.core.content.ContextCompat
        import androidx.swiperefreshlayout.widget.SwipeRefreshLayout
        import androidx.webkit.WebSettingsCompat
        import androidx.webkit.WebViewFeature
        
        class MainActivity : AppCompatActivity() {
            
            private lateinit var webView: WebView
            private lateinit var progressBar: ProgressBar
            private lateinit var swipeRefresh: SwipeRefreshLayout
            private var uploadMessage: ValueCallback<Array<Uri>>? = null
            private val APP_URL = "${{ github.event.inputs.app_url }}"
            
            private val fileChooserLauncher = registerForActivityResult(
                ActivityResultContracts.StartActivityForResult()
            ) { result ->
                if (uploadMessage != null) {
                    val results = WebChromeClient.FileChooserParams.parseResult(result.resultCode, result.data)
                    uploadMessage!!.onReceiveValue(results)
                    uploadMessage = null
                }
            }
            
            private val permissionLauncher = registerForActivityResult(
                ActivityResultContracts.RequestMultiplePermissions()
            ) { permissions ->
                // Handle permissions
            }
            
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                
                window.setFlags(
                    WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED,
                    WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED
                )
                
                setContentView(R.layout.activity_main)
                
                initViews()
                setupAdvancedWebView()
                requestPermissions()
                loadApp()
            }
            
            private fun initViews() {
                webView = findViewById(R.id.webView)
                progressBar = findViewById(R.id.progressBar)
                swipeRefresh = findViewById(R.id.swipeRefresh)
            }
            
            private fun setupAdvancedWebView() {
                webView.settings.apply {
                    javaScriptEnabled = true
                    domStorageEnabled = true
                    databaseEnabled = true
                    allowFileAccess = true
                    allowContentAccess = true
                    loadWithOverviewMode = true
                    useWideViewPort = true
                    setSupportZoom(true)
                    builtInZoomControls = true
                    displayZoomControls = false
                    javaScriptCanOpenWindowsAutomatically = true
                    mediaPlaybackRequiresUserGesture = false
                    mixedContentMode = WebSettings.MIXED_CONTENT_ALWAYS_ALLOW
                    cacheMode = WebSettings.LOAD_DEFAULT
                    setGeolocationEnabled(true)
                    userAgentString = "NYBotsApp/1.0 " + userAgentString
                }
                
                if (WebViewFeature.isFeatureSupported(WebViewFeature.FORCE_DARK)) {
                    WebSettingsCompat.setForceDark(webView.settings, WebSettingsCompat.FORCE_DARK_AUTO)
                }
                
                webView.webViewClient = AdvancedWebViewClient()
                webView.webChromeClient = AdvancedWebChromeClient()
                webView.addJavaScriptInterface(NativeInterface(), "NativeApp")
                
                swipeRefresh.setOnRefreshListener {
                    webView.reload()
                }
                
                swipeRefresh.setColorSchemeResources(
                    android.R.color.holo_blue_bright,
                    android.R.color.holo_green_light,
                    android.R.color.holo_orange_light,
                    android.R.color.holo_red_light
                )
            }
            
            private fun requestPermissions() {
                val permissions = arrayOf(
                    Manifest.permission.CAMERA,
                    Manifest.permission.RECORD_AUDIO,
                    Manifest.permission.ACCESS_FINE_LOCATION,
                    Manifest.permission.READ_EXTERNAL_STORAGE
                )
                permissionLauncher.launch(permissions)
            }
            
            private fun loadApp() {
                progressBar.visibility = View.VISIBLE
                webView.loadUrl(APP_URL)
            }
            
            private inner class AdvancedWebViewClient : WebViewClient() {
                override fun shouldOverrideUrlLoading(view: WebView?, request: WebResourceRequest?): Boolean {
                    val url = request?.url.toString()
                    
                    if (!url.contains(Uri.parse(APP_URL).host ?: "")) {
                        startActivity(Intent(Intent.ACTION_VIEW, Uri.parse(url)))
                        return true
                    }
                    
                    return false
                }
                
                override fun onPageStarted(view: WebView?, url: String?, favicon: Bitmap?) {
                    super.onPageStarted(view, url, favicon)
                    progressBar.visibility = View.VISIBLE
                }
                
                override fun onPageFinished(view: WebView?, url: String?) {
                    super.onPageFinished(view, url)
                    progressBar.visibility = View.GONE
                    swipeRefresh.isRefreshing = false
                }
            }
            
            private inner class AdvancedWebChromeClient : WebChromeClient() {
                override fun onProgressChanged(view: WebView?, newProgress: Int) {
                    progressBar.progress = newProgress
                    if (newProgress == 100) {
                        progressBar.visibility = View.GONE
                    }
                }
                
                override fun onShowFileChooser(
                    webView: WebView?,
                    filePathCallback: ValueCallback<Array<Uri>>?,
                    fileChooserParams: FileChooserParams?
                ): Boolean {
                    uploadMessage = filePathCallback
                    
                    val intent = Intent(Intent.ACTION_GET_CONTENT).apply {
                        type = "*/*"
                        addCategory(Intent.CATEGORY_OPENABLE)
                        putExtra(Intent.EXTRA_ALLOW_MULTIPLE, true)
                    }
                    
                    fileChooserLauncher.launch(Intent.createChooser(intent, "Choose File"))
                    return true
                }
                
                override fun onPermissionRequest(request: PermissionRequest?) {
                    runOnUiThread {
                        request?.grant(request.resources)
                    }
                }
                
                override fun onGeolocationPermissionsShowPrompt(
                    origin: String?,
                    callback: GeolocationPermissions.Callback?
                ) {
                    callback?.invoke(origin, true, false)
                }
            }
            
            private inner class NativeInterface {
                @JavascriptInterface
                fun getDeviceInfo(): String {
                    return """{"platform": "android", "version": "1.0.0", "device": "native"}"""
                }
            }
            
            override fun onKeyDown(keyCode: Int, event: KeyEvent?): Boolean {
                if (keyCode == KeyEvent.KEYCODE_BACK && webView.canGoBack()) {
                    webView.goBack()
                    return true
                }
                return super.onKeyDown(keyCode, event)
            }
            
            override fun onResume() {
                super.onResume()
                webView.onResume()
            }
            
            override fun onPause() {
                super.onPause()
                webView.onPause()
            }
        }
        EOF
        
        # Create SplashActivity.kt
        cat > app/src/main/java/com/nybots/app/SplashActivity.kt << 'EOF'
        package com.nybots.app
        
        import android.animation.AnimatorSet
        import android.animation.ObjectAnimator
        import android.content.Intent
        import android.os.Bundle
        import android.os.Handler
        import android.os.Looper
        import android.view.View
        import android.view.animation.AccelerateDecelerateInterpolator
        import android.widget.ImageView
        import android.widget.TextView
        import androidx.appcompat.app.AppCompatActivity
        
        class SplashActivity : AppCompatActivity() {
            
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                setContentView(R.layout.activity_splash)
                
                window.decorView.systemUiVisibility = (
                    View.SYSTEM_UI_FLAG_LAYOUT_STABLE
                    or View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
                    or View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
                    or View.SYSTEM_UI_FLAG_HIDE_NAVIGATION
                    or View.SYSTEM_UI_FLAG_FULLSCREEN
                    or View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY
                )
                
                setupAnimation()
            }
            
            private fun setupAnimation() {
                val logo = findViewById<ImageView>(R.id.logoImage)
                val title = findViewById<TextView>(R.id.titleText)
                val subtitle = findViewById<TextView>(R.id.subtitleText)
                
                logo.alpha = 0f
                logo.scaleX = 0.5f
                logo.scaleY = 0.5f
                title.alpha = 0f
                title.translationY = 50f
                subtitle.alpha = 0f
                subtitle.translationY = 30f
                
                val logoAnimator = AnimatorSet().apply {
                    playTogether(
                        ObjectAnimator.ofFloat(logo, "alpha", 0f, 1f),
                        ObjectAnimator.ofFloat(logo, "scaleX", 0.5f, 1.2f, 1f),
                        ObjectAnimator.ofFloat(logo, "scaleY", 0.5f, 1.2f, 1f),
                        ObjectAnimator.ofFloat(logo, "rotation", 0f, 360f)
                    )
                    duration = 1000
                    interpolator = AccelerateDecelerateInterpolator()
                }
                
                val titleAnimator = AnimatorSet().apply {
                    playTogether(
                        ObjectAnimator.ofFloat(title, "alpha", 0f, 1f),
                        ObjectAnimator.ofFloat(title, "translationY", 50f, 0f)
                    )
                    duration = 800
                    startDelay = 500
                    interpolator = AccelerateDecelerateInterpolator()
                }
                
                val subtitleAnimator = AnimatorSet().apply {
                    playTogether(
                        ObjectAnimator.ofFloat(subtitle, "alpha", 0f, 1f),
                        ObjectAnimator.ofFloat(subtitle, "translationY", 30f, 0f)
                    )
                    duration = 600
                    startDelay = 800
                    interpolator = AccelerateDecelerateInterpolator()
                }
                
                logoAnimator.start()
                titleAnimator.start()
                subtitleAnimator.start()
                
                Handler(Looper.getMainLooper()).postDelayed({
                    startActivity(Intent(this, MainActivity::class.java))
                    overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out)
                    finish()
                }, 2500)
            }
        }
        EOF
        
    - name: Create Layouts and Resources
      run: |
        cd android-app
        
        # Create splash layout
        cat > app/src/main/res/layout/activity_splash.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <androidx.constraintlayout.widget.ConstraintLayout 
            xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:app="http://schemas.android.com/apk/res-auto"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:background="@drawable/splash_gradient">
        
            <ImageView
                android:id="@+id/logoImage"
                android:layout_width="120dp"
                android:layout_height="120dp"
                android:src="@drawable/ny_bots_logo"
                android:contentDescription="NY BOTS Logo"
                app:layout_constraintBottom_toTopOf="@id/titleText"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toTopOf="parent"
                app:layout_constraintVertical_chainStyle="packed" />
        
            <TextView
                android:id="@+id/titleText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="${{ github.event.inputs.app_name }}"
                android:textColor="@android:color/white"
                android:textSize="32sp"
                android:textStyle="bold"
                android:fontFamily="sans-serif-medium"
                android:layout_marginTop="24dp"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toBottomOf="@id/logoImage"
                app:layout_constraintBottom_toTopOf="@id/subtitleText" />
        
            <TextView
                android:id="@+id/subtitleText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Advanced AI Solutions"
                android:textColor="@android:color/white"
                android:textSize="16sp"
                android:alpha="0.8"
                android:layout_marginTop="8dp"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toBottomOf="@id/titleText"
                app:layout_constraintBottom_toBottomOf="parent" />
        
        </androidx.constraintlayout.widget.ConstraintLayout>
        EOF
        
        # Create main layout
        cat > app/src/main/res/layout/activity_main.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <androidx.constraintlayout.widget.ConstraintLayout 
            xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:app="http://schemas.android.com/apk/res-auto"
            android:layout_width="match_parent"
            android:layout_height="match_parent">
        
            <androidx.swiperefreshlayout.widget.SwipeRefreshLayout
                android:id="@+id/swipeRefresh"
                android:layout_width="match_parent"
                android:layout_height="match_parent">
        
                <WebView
                    android:id="@+id/webView"
                    android:layout_width="match_parent"
                    android:layout_height="match_parent" />
        
            </androidx.swiperefreshlayout.widget.SwipeRefreshLayout>
        
            <ProgressBar
                android:id="@+id/progressBar"
                style="?android:attr/progressBarStyleHorizontal"
                android:layout_width="match_parent"
                android:layout_height="3dp"
                android:progressTint="#FF4081"
                android:progressBackgroundTint="@android:color/transparent"
                app:layout_constraintTop_toTopOf="parent" />
        
        </androidx.constraintlayout.widget.ConstraintLayout>
        EOF
        
        # Create drawable resources
        cat > app/src/main/res/drawable/splash_gradient.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <shape xmlns:android="http://schemas.android.com/apk/res/android">
            <gradient
                android:angle="45"
                android:startColor="#667eea"
                android:centerColor="#764ba2"
                android:endColor="#f093fb"
                android:type="linear" />
        </shape>
        EOF
        
        # Create NY BOTS logo
        cat > app/src/main/res/drawable/ny_bots_logo.xml << 'EOF'
        <vector xmlns:android="http://schemas.android.com/apk/res/android"
            android:width="120dp"
            android:height="120dp"
            android:viewportWidth="120"
            android:viewportHeight="120">
            
            <!-- Background circle -->
            <path android:fillColor="#ffffff"
                  android:pathData="M60,10 A50,50 0 1,1 59.999,10 Z" />
            
            <!-- NY Text -->
            <path android:fillColor="#667eea"
                  android:pathData="M25,35 L35,35 L35,65 L45,35 L55,35 L45,65 L35,65 Z" />
            
            <!-- BOTS circuit pattern -->
            <path android:fillColor="#f093fb"
                  android:pathData="M65,40 L95,40 L95,45 L65,45 Z" />
            <path android:fillColor="#f093fb"
                  android:pathData="M65,50 L85,50 L85,55 L65,55 Z" />
            <path android:fillColor="#f093fb"
                  android:pathData="M65,60 L90,60 L90,65 L65,65 Z" />
                  
            <!-- Circuit dots -->
            <circle android:fillColor="#764ba2" android:cx="70" android:cy="42.5" android:r="2"/>
            <circle android:fillColor="#764ba2" android:cx="80" android:cy="52.5" android:r="2"/>
            <circle android:fillColor="#764ba2" android:cx="75" android:cy="62.5" android:r="2"/>
        </vector>
        EOF
        
    - name: Create Configuration Files
      run: |
        cd android-app
        
        # Create AndroidManifest.xml
        cat > app/src/main/AndroidManifest.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:tools="http://schemas.android.com/tools">
        
            <uses-permission android:name="android.permission.INTERNET" />
            <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
            <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
            <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
            <uses-permission android:name="android.permission.CAMERA" />
            <uses-permission android:name="android.permission.RECORD_AUDIO" />
            <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.VIBRATE" />
            
            <application
                android:allowBackup="true"
                android:icon="@drawable/ny_bots_logo"
                android:label="${{ github.event.inputs.app_name }}"
                android:theme="@style/Theme.NYBotsApp"
                android:usesCleartextTraffic="true"
                android:hardwareAccelerated="true"
                android:largeHeap="true"
                android:supportsRtl="true"
                tools:targetApi="31">
                
                <activity
                    android:name=".SplashActivity"
                    android:exported="true"
                    android:screenOrientation="portrait"
                    android:theme="@style/Theme.NYBotsApp.Splash">
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN" />
                        <category android:name="android.intent.category.LAUNCHER" />
                    </intent-filter>
                </activity>
                
                <activity
                    android:name=".MainActivity"
                    android:exported="false"
                    android:configChanges="orientation|keyboardHidden|screenSize"
                    android:hardwareAccelerated="true"
                    android:launchMode="singleTop" />
                    
            </application>
        </manifest>
        EOF
        
        # Create values/styles.xml
        cat > app/src/main/res/values/styles.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <style name="Theme.NYBotsApp" parent="Theme.MaterialComponents.DayNight.NoActionBar">
                <item name="colorPrimary">#667eea</item>
                <item name="colorPrimaryVariant">#764ba2</item>
                <item name="colorOnPrimary">#FFFFFF</item>
                <item name="colorSecondary">#f093fb</item>
                <item name="colorOnSecondary">#000000</item>
                <item name="android:statusBarColor">@android:color/transparent</item>
                <item name="android:windowLightStatusBar">false</item>
                <item name="android:navigationBarColor">@android:color/transparent</item>
            </style>
        
            <style name="Theme.NYBotsApp.Splash" parent="Theme.NYBotsApp">
                <item name="android:windowNoTitle">true</item>
                <item name="android:windowActionBar">false</item>
                <item name="android:windowFullscreen">true</item>
                <item name="android:windowContentOverlay">@null</item>
                <item name="android:windowBackground">@drawable/splash_gradient</item>
            </style>
        </resources>
        EOF
        
        # Create values/strings.xml
        cat > app/src/main/res/values/strings.xml << 'EOF'
        <resources>
            <string name="app_name">${{ github.event.inputs.app_name }}</string>
        </resources>
        EOF
        
        # Create values/colors.xml
        cat > app/src/main/res/values/colors.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <color name="primary">#667eea</color>
            <color name="primary_variant">#764ba2</color>
            <color name="secondary">#f093fb</color>
            <color name="white">#FFFFFF</color>
            <color name="black">#000000</color>
        </resources>
        EOF
        
        # Create proguard rules
        cat > app/proguard-rules.pro << 'EOF'
        -keepattributes *Annotation*
        -keepclassmembers class * {
            @android.webkit.JavascriptInterface <methods>;
        }
        -keepclassmembers class * extends android.webkit.WebViewClient {
            public void *(android.webkit.WebView, java.lang.String, android.graphics.Bitmap);
            public boolean *(android.webkit.WebView, java.lang.String);
        }
        -keepclassmembers class * extends android.webkit.WebChromeClient {
            public void *(android.webkit.WebView, java.lang.String);
        }
        -keep class com.nybots.app.** { *; }
        EOF
        
    - name: Cache Gradle Dependencies
      uses: actions/cache@v3
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-gradle-
          
    - name: Build Project
      run: |
        cd android-app
        chmod +x gradlew
        ./gradlew clean
        ./gradlew assembleDebug --stacktrace
        ./gradlew assembleRelease --stacktrace
        
    - name: Sign Release APK
      run: |
        cd android-app
        keytool -genkey -v -keystore app-release-key.keystore -alias app-key -keyalg RSA -keysize 2048 -validity 10000 -storepass android -keypass android -dname "CN=NY BOTS, OU=Mobile, O=NY BOTS, L=New York, S=NY, C=US"
        
        if [ -f "app/build/outputs/apk/release/app-release-unsigned.apk" ]; then
          jarsigner -verbose -sigalg SHA256withRSA -digestalg SHA-256 -keystore app-release-key.keystore -storepass android -keypass android app/build/outputs/apk/release/app-release-unsigned.apk app-key
          $ANDROID_HOME/build-tools/34.0.0/zipalign -v 4 app/build/outputs/apk/release/app-release-unsigned.apk app/build/outputs/apk/release/app-release-signed.apk
        fi
        
    - name: Prepare APKs for Upload
      run: |
        cd android-app
        APP_NAME="${{ github.event.inputs.app_name }}"
        CLEAN_NAME=$(echo "$APP_NAME" | tr ' ' '_' | tr -cd '[:alnum:]_')
        
        # Copy and rename APKs
        if [ -f "app/build/outputs/apk/debug/app-debug.apk" ]; then
          cp app/build/outputs/apk/debug/app-debug.apk "${CLEAN_NAME}_Debug.apk"
        fi
        
        if [ -f "app/build/outputs/apk/release/app-release-signed.apk" ]; then
          cp app/build/outputs/apk/release/app-release-signed.apk "${CLEAN_NAME}_Release.apk"
        elif [ -f "app/build/outputs/apk/release/app-release.apk" ]; then
          cp app/build/outputs/apk/release/app-release.apk "${CLEAN_NAME}_Release.apk"
        fi
        
        # Create build info
        cat > build-info.txt << EOF
        NY BOTS Advanced WebView App
        ============================
        App Name: ${{ github.event.inputs.app_name }}
        Package: ${{ github.event.inputs.package_name }}
        Content URL: ${{ github.event.inputs.app_url }}
        Build Date: $(date)
        
        Features:
        âœ… Advanced WebView with native integration
        âœ… Premium splash screen with animations
        âœ… Camera and media access
        âœ… Geolocation services
        âœ… File upload/download
        âœ… Pull-to-refresh functionality
        âœ… Hardware acceleration
        âœ… Native app experience
        
        APK Files Generated:
        $(ls -la *_*.apk 2>/dev/null || echo "No APK files found")
        EOF
        
        ls -la
        
    - name: Upload APK Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ny-bots-apks
        path: |
          android-app/*_Debug.apk
          android-app/*_Release.apk
          android-app/build-info.txt
        retention-days: 30
        
    - name: Build Summary
      run: |
        cd android-app
        echo "## ðŸ“± NY BOTS App Build Complete!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸš€ App Configuration:" >> $GITHUB_STEP_SUMMARY
        echo "- **App Name:** ${{ github.event.inputs.app_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Package:** ${{ github.event.inputs.package_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Content URL:** ${{ github.event.inputs.app_url }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“¦ Generated APKs:" >> $GITHUB_STEP_SUMMARY
        if [ -f "*_Debug.apk" ]; then
          echo "âœ… Debug APK created successfully" >> $GITHUB_STEP_SUMMARY
        fi
        if [ -f "*_Release.apk" ]; then
          echo "âœ… Release APK created and signed" >> $GITHUB_STEP_SUMMARY
        fi
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“‹ Features Included:" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸŽ¨ Premium splash screen with NY BOTS logo" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“± Advanced WebView with native features" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ”„ Pull-to-refresh functionality" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“¸ Camera and file upload support" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“ Geolocation services" >> $GITHUB_STEP_SUMMARY
        echo "- âš¡ Hardware acceleration enabled" >> $GITHUB_STEP_SUMMARY
